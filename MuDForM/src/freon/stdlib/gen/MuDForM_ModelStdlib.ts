// Generated by the Freon Language Generator.
import { FreNamedNode, FreStdlib, FreLanguage } from "@freon4dsl/core";
import { DatomicType } from "../../language/gen/index.js";
import { freonConfiguration } from "../../config/FreonConfiguration.js";
import { ListUtil } from "../../utils/gen/ListUtil.js";

/**
 * Class MuDForM_ModelStdlib provides an entry point for all predefined elements in language MuDForM_Model.
 * It holds all instances of limited concepts as defined in the language definition file.
 *
 * This class uses the singleton pattern to ensure that only one instance of the class is present.
 */
export class MuDForM_ModelStdlib implements FreStdlib {
    private static stdlib: FreStdlib; // the only instance of this class

    /**
     * This method implements the singleton pattern
     */
    public static getInstance(): FreStdlib {
        if (this.stdlib === undefined || this.stdlib === null) {
            this.stdlib = new MuDForM_ModelStdlib();
        }
        return this.stdlib;
    }

    public elements: FreNamedNode[] = []; // the predefined elements of language MuDForM_Model

    /**
     * A private constructor, as demanded by the singleton pattern,
     * in which the list of predefined elements is filled.
     */
    private constructor() {
        this.elements.push(DatomicType.bigdec);
        this.elements.push(DatomicType.bigint);
        this.elements.push(DatomicType.boolean);
        this.elements.push(DatomicType.bytes);
        this.elements.push(DatomicType.double);
        this.elements.push(DatomicType.float);
        this.elements.push(DatomicType.instant);
        this.elements.push(DatomicType.keyword);
        this.elements.push(DatomicType.long);
        this.elements.push(DatomicType.string);
        this.elements.push(DatomicType.symbol);
        this.elements.push(DatomicType.uuid);
        this.elements.push(DatomicType.uri);
        for (const lib of freonConfiguration.customStdLibs) {
            ListUtil.addAllIfNotPresent<FreNamedNode>(this.elements, lib.elements);
        }
    }

    /**
     * Returns the element named 'name', if it can be found in this library.
     * If the element can not be found, 'null' is returned.
     * When 'metatype' is provided, the element is only returned when it is
     * an instance of this metatype.
     * @param name
     * @param metatype
     */
    public find(name: string, metatype?: string): FreNamedNode {
        if (!!name) {
            const possibles = this.elements.filter((elem) => elem.name === name);
            if (possibles.length !== 0) {
                if (metatype) {
                    for (const elem of possibles) {
                        if (FreLanguage.getInstance().metaConformsToType(elem, metatype)) {
                            return elem;
                        }
                    }
                } else {
                    return possibles[0];
                }
            }
        }
        return null;
    }
}
